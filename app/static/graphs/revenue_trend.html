<h2>Revenue Trends</h2>

<!-- Year Dropdown -->
<label for="year">Select Year:</label>
<select id="year" onchange="updateYearGraph()">
    <option value="">📊 Select Year</option>
    <option value="2015">2015</option>
    <option value="2016">2016</option>
    <option value="2017">2017</option>
</select>

<!-- Month Dropdown -->
<div id="month-container" style="display: none; margin-top: 10px;">
    <label for="month">Select Month:</label>
    <select id="month" onchange="showGranularityDropdown()">
        <option value="">📅 Select Month</option>
        <option value="January">January</option>
        <option value="February">February</option>
        <option value="March">March</option>
        <option value="April">April</option>
        <option value="May">May</option>
        <option value="June">June</option>
        <option value="July">July</option>
        <option value="August">August</option>
        <option value="September">September</option>
        <option value="October">October</option>
        <option value="November">November</option>
        <option value="December">December</option>
    </select>
</div>

<!-- Granularity Dropdown -->
<div id="granularity-container" style="display: none; margin-top: 10px;">
    <label for="granularity">Select Granularity:</label>
    <select id="granularity" onchange="updateGranularityGraph()">
        <option value="daily">📅 Daily</option>
        <option value="weekly">📆 Weekly</option>
    </select>
</div>

<!-- Graph Container -->
<h3>Trend Visualization</h3>
<div id="graph-container">
    <iframe id="graph-frame" src="/static/graphs/revenue_trend.html" width="100%" height="500px"></iframe>
</div>

<!-- JavaScript to Update Graph -->
<script>
    function updateGranularityGraph() {
        const year = document.getElementById("year").value;
        const month = document.getElementById("month").value;
        const granularity = document.getElementById("granularity").value;

        if (granularity) {
            fetch(`/get_revenue_graph?trend_type=${granularity}&year=${year}&month=${month}`)
                .then((response) => response.json())
                .then((data) => {
                    if (data.error) {
                        console.error("❌ Error loading graph:", data.error);
                        document.getElementById("graph-container").innerHTML =
                            `<p>${data.error}</p>`;
                        return;
                    }

                    // ✅ Update iframe to load the latest graph
                    document.getElementById("graph-frame").src = data.graph_path;
                })
                .catch((error) => {
                    console.error("❌ Error loading graph:", error);
                    document.getElementById("graph-container").innerHTML =
                        "<p>Error loading graph.</p>";
                });
        }
    }
</script>
